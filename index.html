<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IronBot</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            color: #fff;
            overflow-x: hidden;
        }

        .hero-section {
            height: 100vh;
            background: linear-gradient(rgba(0, 0, 0, 0.2), rgba(0, 0, 0, 0.5)),
                url('https://c4.wallpaperflare.com/wallpaper/106/134/436/iron-man-superhero-digital-art-black-background-wallpaper-preview.jpg') center/cover no-repeat;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            position: relative;
        }

        .logo {
            font-size: 5rem;
            font-weight: bold;
            background: linear-gradient(45deg, #ffd700, #ff4444, #ffd700);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            text-shadow: 0 0 30px rgba(255, 68, 68, 0.5);
            margin-bottom: 1rem;
            letter-spacing: 0.1em;
        }

        .tagline {
            font-size: 1.5rem;
            color: #ffd700;
            margin-bottom: 3rem;
            text-transform: uppercase;
            letter-spacing: 0.3em;
        }

        .content-section {
            background: rgb(0, 0, 0);
            padding: 4rem 2rem;
            min-height: 100vh;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        .controls-section {
            margin-bottom: 4rem;
        }

        .section-title {
            font-size: 2.5rem;
            color: #ffd700;
            margin-bottom: 2rem;
            text-align: center;
            text-transform: uppercase;
            letter-spacing: 0.2em;
        }

        .section-text {
            margin: 0 auto;
            width: fit-content;
            margin-bottom: 2rem;
            margin-top: -1rem;
        }

        .wasd-container {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 1rem;
            flex-wrap: wrap;
            padding: 3rem;
        }

        .wasd-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 0.5rem;
            max-width: 300px;
        }

        .wasd-key {
            width: 90px;
            height: 90px;
            background: linear-gradient(145deg, #2a2a2a, #1a1a1a);
            border: 3px solid #ff4444;
            border-radius: 10px;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 2rem;
            font-weight: bold;
            color: #ffd700;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(255, 68, 68, 0.3);
        }

        .wasd-key:hover {
            background: linear-gradient(145deg, #ff4444, #cc0000);
            transform: translateY(-5px);
            box-shadow: 0 6px 25px rgba(255, 68, 68, 0.6);
        }

        .wasd-key:active {
            transform: translateY(-2px);
        }

        .wasd-key.active {
            background: linear-gradient(145deg, #ff4444, #cc0000);
            box-shadow: 0 6px 25px rgba(255, 68, 68, 0.8);
        }

        .key-w {
            grid-column: 2;
        }

        .key-a {
            grid-column: 1;
            grid-row: 2;
        }

        .key-s {
            grid-column: 2;
            grid-row: 2;
        }

        .key-d {
            grid-column: 3;
            grid-row: 2;
        }

        .chat-section {
            margin-bottom: 4rem;
        }

        .chat-container {
            max-width: 200px;
            margin: 0 auto;
            width: fit-content;
            /* background: linear-gradient(145deg, #1a1a1a, #0a0a0a); */
            /* border: 2px solid #ff4444; */
            /* border-radius: 15px; */
            /* padding: 2rem; */
            /* box-shadow: 0 8px 30px rgba(255, 68, 68, 0.3); */
        }

        .chat-display {
            height: 400px;
            background: #000;
            border: 1px solid #333;
            border-radius: 10px;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
            overflow-y: auto;
            font-family: 'Courier New', monospace;
            color: #00ff00;
        }

        .chat-input-container {
            display: flex;
            gap: 1rem;
            align-items: center;
        }

        .mic-button {
            width: 160px;
            height: 160px;
            background: linear-gradient(145deg, #ff4444, #cc0000);
            border: none;
            border-radius: 50%;
            color: #fff;
            font-size: 6rem;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            justify-content: center;
            align-items: center;
            flex-shrink: 0;
        }

        .mic-button:hover {
            background: linear-gradient(145deg, #ffd700, #ffaa00);
            transform: scale(1.1);
            box-shadow: 0 4px 15px rgba(255, 215, 0, 0.5);
            box-shadow: 0 8px 30px rgba(255, 68, 68, 0.3);
        }

        .mic-button:active {
            transform: scale(0.95);
            background: linear-gradient(145deg, #ff883f, #ff680a);
        }

        .mic-button.active {
            transform: scale(0.95);
            background: linear-gradient(145deg, #ff883f, #ff680a);
        }

        .chat-input {
            flex: 1;
            padding: 1rem;
            background: #1a1a1a;
            border: 2px solid #ff4444;
            border-radius: 8px;
            color: #ffd700;
            font-size: 1rem;
            outline: none;
            transition: all 0.3s ease;
        }

        .chat-input:focus {
            border-color: #ffd700;
            box-shadow: 0 0 15px rgba(255, 215, 0, 0.3);
        }

        .send-button {
            padding: 1rem 2.5rem;
            background: linear-gradient(145deg, #ff4444, #cc0000);
            border: none;
            border-radius: 8px;
            color: #fff;
            font-size: 1rem;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 0.1em;
        }

        .send-button:hover {
            background: linear-gradient(145deg, #ffd700, #ffaa00);
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(255, 215, 0, 0.5);
        }

        .about-section {
            background: rgb(0, 0, 0);
            padding: 4rem 2rem;
            border-top: 2px solid #ff4444;
        }

        .about-content {
            max-width: 800px;
            margin: 0 auto;
            text-align: center;
            color: #aaa;
            line-height: 1.8;
        }

        .about-content p {
            margin-bottom: 1rem;
        }
    </style>
</head>

<body>
    <div class="hero-section">
        <div class="logo">IRONBOT</div>
        <div class="tagline">Powered by Arc Reactor</div>
    </div>

    <div class="content-section">
        <div class="container">
            <div class="controls-section">
                <h2 class="section-title">Movement Controls</h2>
                <div class="wasd-container">
                    <div class="wasd-grid">
                        <div class="wasd-key key-w">W</div>
                        <div class="wasd-key key-a">A</div>
                        <div class="wasd-key key-s">S</div>
                        <div class="wasd-key key-d">D</div>
                    </div>
                </div>
            </div>

            <div class="chat-section">
                <h2 class="section-title">Communication Interface</h2>
                <p class="section-text">Press Space to start</p>
                <div class="chat-container">
                    <button class="mic-button">ðŸŽ¤</button>
                </div>
            </div>
        </div>
    </div>

    <div class="about-section">
        <div class="container">
            <h2 class="section-title">About The Project</h2>
            <div class="about-content">
                <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Sed do eiusmod tempor incididunt ut labore
                    et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut
                    aliquip ex ea commodo consequat.</p>
                <p>Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla
                    pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit
                    anim id est laborum.</p>
                <p>Sed ut perspiciatis unde omnis iste natus error sit voluptatem accusantium doloremque laudantium,
                    totam rem aperiam, eaque ipsa quae ab illo inventore veritatis et quasi architecto beatae vitae
                    dicta sunt explicabo.</p>
            </div>
        </div>
    </div>

    <script>
        // WASD functionality
        const keys = {
            w: document.querySelector('.key-w'),
            a: document.querySelector('.key-a'),
            s: document.querySelector('.key-s'),
            d: document.querySelector('.key-d'),
            space: document.querySelector('.mic-button')
        };

        const BACKEND_API = "192.168.4.1";
        const moveMap = {
            w: 'forward',
            s: 'backward',
            // d: 'right',
            // a: 'left',
        };

        function handleKeyPress(key) {
            const url = `${BACKEND_API}/${moveMap[key]}`;
            fetch(url)
                .then(response => console.log(response.status))
                .catch(err => console.error('Move request error', err));
        }

        // Click handlers for WASD buttons
        Object.entries(keys).forEach(([key, element]) => {
            element.addEventListener('click', () => {
                if (key === 'space') handleMic();
                else handleKeyPress(key);
            });
        });

        // Keyboard listeners for WASD
        document.addEventListener('keydown', (e) => {
            let key = e.key.toLowerCase();
            key = key === " " ? 'space' : key;
            if (keys[key]) {
                e.preventDefault();
                keys[key].classList.add('active');
                if (key === 'space') {
                    handleMic()
                } else {
                    handleKeyPress(key);
                }
            }
        });

        document.addEventListener('keyup', (e) => {
            let key = e.key.toLowerCase();
            key = key === " " ? 'space' : key;
            if (keys[key]) {
                keys[key].classList.remove('active');
                if (key == 'space') stopMic();
            }
        });

        const SpeechRecognition =
            window.SpeechRecognition || window.webkitSpeechRecognition;
        const SpeechRecognitionEvent =
            window.SpeechRecognitionEvent || window.webkitSpeechRecognitionEvent;

        const commandsList = [
            'forward',
            'backward',
            'left',
            'right',
            'stop',
        ]
        let recognition;
        let isListening = false;
        let isStopping = false;
        let waitingForResult = false;

        function updateMicText(payload) {
            const para = document.querySelector('.section-text');
            para.textContent = payload
        }

        function findMatch(transcript) {
            const textSections = transcript.split(" ")
            let res = ""
            for (const text of textSections) {
                const matchedCommand = commandsList.find(cmd => text.includes(cmd));
                if (matchedCommand) res = matchedCommand
            }
            return res
        }

        function initRecognition() {
            recognition = new SpeechRecognition();
            recognition.continuous = true;
            recognition.lang = "en-US";
            recognition.interimResults = false;
            recognition.maxAlternatives = 1;

            recognition.onresult = (event) => {
                const transcript = event.results[event.results.length - 1][0].transcript.toLowerCase().trim();
                console.log(`Heard: ${transcript}`);

                // Check if transcript matches any command
                const matchedCommand = findMatch(transcript)
                if (matchedCommand) {
                    console.log(`âœ“ Matched command: ${matchedCommand}`);
                    updateMicText(matchedCommand)
                }

                // If we're waiting for a result before stopping, stop now
                if (waitingForResult) {
                    waitingForResult = false;
                    finishStopping();
                }
            };

            recognition.onend = () => {
                if (isListening && !isStopping) {
                    recognition.start();
                } else if (isStopping) {
                    // Recognition ended while stopping
                    finishStopping();
                }
            };

            recognition.onerror = (event) => {
                console.error('Speech recognition error:', event.error);
                if (isStopping) {
                    finishStopping();
                }
            };
        }

        function finishStopping() {
            isListening = false;
            isStopping = false;
            waitingForResult = false;
            micButton.classList.remove('active');
            updateMicText('Press Space to start')
            console.log('Microphone stopped');
        }

        function handleMic() {
            // Don't start if we're in the process of stopping
            if (isStopping) {
                console.log('Still stopping, please wait...');
                return;
            }

            if (!recognition) {
                initRecognition();
            }
            if (!isListening) {
                isListening = true;
                recognition.start();
                updateMicText('Start...')
                micButton.classList.add('active');
                console.log('Microphone started - listening...');
            }
        }

        function stopMic() {
            if (!isListening) return;

            isStopping = true;
            waitingForResult = true;
            console.log('Stopping microphone - waiting for final result...');

            // Set a timeout as fallback in case no result comes
            setTimeout(() => {
                if (waitingForResult) {
                    console.log('Timeout reached, stopping without result');
                    waitingForResult = false;
                    finishStopping();
                    recognition.stop();
                }
            }, 3000); // 3 second timeout
        }

        // Microphone functionality
        const micButton = document.querySelector('.mic-button');
        micButton.addEventListener('click', handleMic);
    </script>
</body>

</html>
